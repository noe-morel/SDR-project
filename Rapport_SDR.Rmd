---
title: "Rapport SDR"
output: html_document
date: "2024-01-19"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)

library(plotly)

```

## IMPORT des données

```{r import}
detail_departemental <- readr::read_delim("barometre-resultats-detail-departemental.csv", delim = ",", trim_ws = TRUE, show_col_types = FALSE)
detail_regional <- readr::read_delim("barometre-resultats-detail-regional.csv", delim = ",", trim_ws = TRUE, show_col_types = FALSE)
detail_national <- readr::read_delim("barometre-resultats-detail-national.csv", delim = ",", trim_ws = TRUE, show_col_types = FALSE)
synthese_departemental <- readr::read_delim("barometre-resultats-synthese-departemental.csv", delim = ",", trim_ws = TRUE, show_col_types = FALSE)
synthese_regional <- readr::read_delim("barometre-resultats-synthese-regional.csv", delim = ",", trim_ws = TRUE, show_col_types = FALSE)
synthese_national <- readr::read_delim("barometre-resultats-synthese-national.csv", delim = ",", trim_ws = TRUE, show_col_types = FALSE)

reg_dep <- readr::read_delim("departements-france.csv", delim = ",", trim_ws = TRUE, show_col_types = FALSE)

reg_dep$nom_departement <- gsub("ô","o",reg_dep$nom_departement)


reg_dep$nom_departement <- iconv(reg_dep$nom_departement,to="ASCII//TRANSLIT")
reg_dep$nom_departement <- gsub("'","",reg_dep$nom_departement)
reg_dep$nom_departement <- gsub("`","",reg_dep$nom_departement)
reg_dep$nom_departement <- tolower(reg_dep$nom_departement)
reg_dep$nom_departement <- tolower(gsub(' ','-',reg_dep$nom_departement))

reg_dep$nom_region <- gsub("ô","o",reg_dep$nom_region)


reg_dep$nom_region <- iconv(reg_dep$nom_region,to="ASCII//TRANSLIT")
reg_dep$nom_region <- gsub("'","",reg_dep$nom_region)
reg_dep$nom_region <- gsub("`","",reg_dep$nom_region)
reg_dep$nom_region <- tolower(reg_dep$nom_region)
reg_dep$nom_region <- tolower(gsub(' ','-',reg_dep$nom_region))


mapdata <- map_data("france")
mapdata$region <- tolower(gsub(' ','-',mapdata$region))

synthese_departemental$libelle_departement <- gsub("ô","o",synthese_departemental$libelle_departement)

synthese_departemental$libelle_departement <- iconv(synthese_departemental$libelle_departement,to="ASCII//TRANSLIT")
synthese_departemental$libelle_departement <- gsub("'","",synthese_departemental$libelle_departement)
synthese_departemental$libelle_departement <- gsub("`","",synthese_departemental$libelle_departement)
synthese_departemental$libelle_departement <- tolower(synthese_departemental$libelle_departement)
synthese_departemental$libelle_departement <- tolower(gsub(' ','-',synthese_departemental$libelle_departement))

detail_departemental$libelle_departement <- iconv(detail_departemental$libelle_departement,to="ASCII//TRANSLIT")
detail_departemental$libelle_departement <- gsub("'","",detail_departemental$libelle_departement)
detail_departemental$libelle_departement <- tolower(detail_departemental$libelle_departement)
detail_departemental$libelle_departement <- tolower(gsub(' ','-',detail_departemental$libelle_departement))

synthese_regional$libelle_region <- gsub("ô","o",synthese_regional$libelle_region)
synthese_regional$libelle_region <- iconv(synthese_regional$libelle_region,to="ASCII//TRANSLIT")
synthese_regional$libelle_region <- gsub("'","",synthese_regional$libelle_region)
synthese_regional$libelle_region <- gsub("`","",synthese_regional$libelle_region)
synthese_regional$libelle_region <- tolower(synthese_regional$libelle_region)
synthese_regional$libelle_region <- tolower(gsub(' ','-',synthese_regional$libelle_region))
```

## Plan 1 jeune 1 solution

Dans cette partie, nous allons nous concentrer sur la mise en place du plan 1 jeune 1 solution mis en place à partir de l'été 2020.

Ce plan gouvernemental a pour objectif d'améliorer l'insertion des jeunes dans la vie professionnelle. Pour atteindre cet objectif, le plan se concentre sur 3 axes :

-Faciliter l'entrée dans la vie professionnelle avec des aides pour les employeurs qui recrutent des jeunes, des aides plus importantes sont aussi disponibles pour les contrats d'apprentissages. A cela s'ajoute la création de mission de service civique rémunérée et de métiers dans le secteur du sport.

-Orienter et former les jeunes, à l'aide de parcours de formations qualifiants et professionnalisants.

-Proposer un accompagnement plus personnalisé pour les jeunes en difficultés.

Pour mesurer l'impact des mesures mises en place, notre base de données à choisi comme indicateur le nombre de jeune recrutés. Ainsi, pour chaque mois depuis août 2019, on a accès au nombre de jeune recrutés depuis le dernier mois d'août.

Afin d'étudier l'impact de ce plan à différentes échelles, nous allons effectuer un zoom progressif aux différentes échelles disponibles afin d'interpréter ces nombres.

Pour la première étape, nous allons étudier les chiffres à l'échelle nationale. Pour cela nous allons tracer le nombre de jeune recruter depuis le mois d'août dernier pour chaque mois depuis août 2019 à fin 2022 (information donnée par la base de données), mais aussi le nombre de jeunes recrutés par mois, afin de pouvoir suivre une progression continue.

Afin d'obtenir le nombre de recruter par mois, nous avons créé une nouvelle colonne qui prends pour valeur la différence du nombre de personne recruter depuis août pour un mois et qui fait la différence avec la valeur du mois précédent.

```{r 1 jeune 1 solution National}

UnJeuneNational <- detail_national |>
  filter(mesure=="Plan 1 jeune 1 solution") |>
  mutate(recrutés_par_mois = if_else(valeur>lag(valeur), valeur-lag(valeur), valeur, missing=valeur))|>
  rename(recrutés_cumulés = valeur) |>
  pivot_longer(c(recrutés_cumulés, recrutés_par_mois), names_to = "type", values_to = "valeur") |>
  mutate(year = year(date)) |>
  ggplot() + 
  geom_line(mapping=aes(x=date, y=valeur, fg=type)) +
  labs(title = "Jeunes recrutés grâce au projet",
       x = "Date",
       y = "Nombre de recrutement",
       fg="")


plotly::ggplotly(UnJeuneNational)


```

Tout d'abord, on peut très rapidement repérer une saisonnalité importante grâce à la courbe de recrutement par mois. En effet, chaque année, le nombre de jeune recruté pendant le mois de septembre est très important par rapport au reste de l'année. Cette période de fort recrutement des jeunes peut sans doute être expliquer par le fait que le début d'année pour les jeunes et en septembre, ainsi de nombreux contrats d'apprentissages doivent commencer en septembre.

Ensuite, en regardant les pics de chaque année (donc le mois de juillet de chaque année), on peut remarquer une baisse du recrutement des jeunes en 2020. Cette chute est surement due à la crise COVID. Cette interprétation est corroborée par la chute observée autour d'avril 2020, le début de la crise COVID.

Après la grosse chute de recrutement mensuel causé par la crise, on observe une forte augmentation du recrutement à l'été 2020, cela coïncide avec le début du plan 1 jeune 1 solution. Il est donc raisonnable de supposer que ce plan à permis de neutralisé l'impact de la crise sur le recrutement des jeunes. Ainsi on observe une remontée du nombre de recrutement pour 2021 au niveau de celui de 2019.

L'augmentation continue ensuite pour 2022. On peut donc supposer qu'à l'échelle nationale, le plan a eu des conséquences positives sur le recrutement des jeunes.

Regardons maintenant à l'échelle régionale, pour chaque année, pour voir si l'on retrouve la même progression annuelle.

```{r 1 jeune 1 solution Regions, fig.width=14}

UnJeuneNational <- detail_regional |>
  filter(mesure=="Plan 1 jeune 1 solution" & month(date)==7) |>
  mutate(year = year(date)) |>
  ggplot() + 
  geom_col(mapping = aes(x=libelle_region, y=valeur, bg=libelle_region))+
  theme(axis.text.x=element_blank(),axis.ticks.x=element_blank(),axis.title.x=element_blank())+
  facet_wrap(vars(year), nrow=1)+
  labs(title = "Jeunes recrutés grâce au projet par région",
       x = "Date",
       y = "Nombre de recrutement",
       bg="Région")

plotly::ggplotly(UnJeuneNational)

```

Tout d'abord on peut remarquer que l'Île de France est une très grande région recruteuse de jeunes, mais c'est aussi la région la plus peuplée de France, ces chiffres sont donc à relativiser. Ensuite, pour chaque région on peut retrouver une chute du recrutement pour l'année 2021, comme pour la tendance nationale. On peut remarquer aussi que le nombre de jeune recruté à Mayotte est de 0 (et pas NA). Cependant il est très peu probable qu'aucun jeune ait trouvé un emploi à la réunion à Mayotte pendant 4 année de suite, cette information est donc sans doute manquante.

En raison des fortes disparités de population en fonction de la région, ce graphe ne nous permet pas de faire des observations précises. Ainsi pour offrir un autre point de vue, nous avons décidé de représenter le pourcentage d'évolution du recrutement entre chaque année, en enlevant Mayotte qui ne présente donc pas d'informations.

```{r 1 jeune 1 solution Regions, fig.width=14}

UnJeuneNationalPC <- detail_regional |>
  filter(mesure=="Plan 1 jeune 1 solution" & month(date)==7 & code_region!="06") |>
  mutate(year = year(date)) |>
  mutate(valeur_pc = if_else(year!=2019, 100+(valeur-lag(valeur))/lag(valeur)*100, 100))|>
  ggplot() + 
  geom_col(mapping = aes(x=libelle_region, y=valeur_pc, bg=libelle_region))+
  theme(axis.text.x=element_blank(),axis.ticks.x=element_blank(),axis.title.x=element_blank())+
  facet_wrap(vars(year), nrow=1)+
  labs(title = "Jeunes recrutés grâce au projet par région",
       x = "Date",
       y = "Nombre de recrutement",
       bg="Région")

plotly::ggplotly(UnJeuneNationalPC)
```

Sur ce graphe, on a donc toutes les régions à 100 en 2019 (nous n'avons pas les chiffres de juillet 2018, donc on ne peut pas les comparer à ceux de juillet 2019). Pour les années suivantes, on peut observer l'évolution du recrutement par rapport à l'année précédente par région.

Comme on le savait déjà, toutes les régions ont subi une baisse du recrutement en 2020, cette baisse est d'autant plus marquée pour les régions Corse, Guyane, Martinique et Provence-Alpes-Côte-d'Azur. Ces régions sont des régions très dépendantes du tourisme, surtout en période estivale. Elles ont donc été fortement impactées par le confinement d'Avril-Mai 2020, ce qui a sans doute causé ces chutes importantes.

De plus, en 2021, les régions qui ont vu leur recrutement le plus progresser sont de même les régions d'Outre-Mer et la Corse. On peut donc supposer que ce même facteur du tourisme, ayant repris à pleine intensité en 2021 soit la cause de cette augmentation. A l'inverse, la région Île-de-France est la seule n'ayant pas progresser durant cette année.

Pour 2022, les chiffres des régions des départements d'Outre-Mer sont moins importants, même s'ils continuent d'augmenter malgré leur très forte augmentation l'année précédente. Sur la même période, toutes les régions de la métropole voient leur chiffre augmenté, avec des valeurs proches sur tout le territoire, avec des chiffres plus importants pour la région Auvergne-Rhône-Alpes, l'Île-de-France et la région PACA.

Pour continuer l'analyse à un niveau départementale, nous avons décidé de nous concentrer sur la région PACA qui présente beaucoup de variations et des chiffres importants. Nous allons donc tracer la valeur mensuelle du recrutement en région PACA.

```{r 1 jeune 1 solution region IdF}

UnJeunePACA <- detail_regional |>
  filter(mesure=="Plan 1 jeune 1 solution" & code_region=="93") |>
  mutate(valeur_mois = if_else(valeur>lag(valeur), valeur-lag(valeur), valeur, missing=valeur))|>
  mutate(year = year(date)) |>
  ggplot() + 
  geom_line(mapping=aes(x=date, y=valeur_mois)) +
  labs(title = "Jeunes recrutés grâce au projet en région PACA",
       x = "Date",
       y = "Nombre de recrutement")

plotly::ggplotly(UnJeunePACA)


```

Tout d'abord, nous pouvons remarquer une différence avec l'évolution nationale. Pour la progression nationale, les chiffres de recrutement sont a peu prêt constant sur la période décembre-juin, alors que pour la région PACA, on observe une première augmentation du recrutement dès le mois d'avril. Cela est sans doute dû à l'activité saisonnière de la région. La crise du COVID à donc fortement impacté la région, le nombre de recrutement en avril ayant été extremement bas par rapport à la normale.

Même si l'on pourrait croire que le pic de septembre 2020 n'a pas été beaucoup impacté par la crise car il ne présente pas d'évolution significative, on peut remarquer que les autres pics sont tous alignés et suivent donc une tendance claire que celui de 2020 ne suit pas.

Cette dernière observation nous pousse d'ailleurs à nous demander si le plan d'action du gouvernement à réellement un impact sur le recrutement des jeunes. En effet si les chiffres du recrutement semblent suivre la même évolution avant et après 2021, on peut se demander si le plan réellement une utilité, même s'il a peut-être aider à la reprise de l'activité.

Pour finir cette analyse, nous allons regarder l'évolution du nombre de recrutement par an par département, toujours dans la région PACA. Pour offrir un outil de comparaison, nous affichons en même temps en noir la courbe d'évolution nationale.

```{r 1 jeune 1 solution départements IdF}

test <- detail_departemental |>
  filter(month(date)==7 & mesure=="Plan 1 jeune 1 solution")|>
  mutate(year = year(date))|>
  group_by(year)|>
  mutate(moyenne = mean(valeur))

UnJeuneDepPACA <- detail_departemental |>
  left_join(reg_dep, by = c("code_departement"="code_departement"))|>
  filter(mesure=="Plan 1 jeune 1 solution" & month(date)==7)|>
  add_column(moyenne = test$moyenne) |>
  filter(code_region=="93")|>
  mutate(year = year(date)) |>
  ggplot() + 
  geom_line(mapping=aes(x=year(date), y=valeur, fg = libelle_departement))+
  geom_line(mapping = aes(x = year(date), y=moyenne))  +
  labs(title = "Jeunes recrutés grâce au projet en PACA par département",
       x = "Date",
       y = "Nombre de recrutement",
       fg="Département")


plotly::ggplotly(UnJeuneDepPACA)

```

Tout d'abord, on peut voir que 2 départements, les Hautes-Alpes et les Alpes-de-Haute-Provence se démarquent par leur faible recrutement de jeunes. Ces mêmes départements présentent une très faible évolution de leur nombre de recrutement.

L'évolution des recrutements du Vaucluse est très proche de l'évolution nationale, même si pour des chiffres moins importants. Cette évolution nationale présente évidement une chute en 2020, et une progression sur 4 ans de 25%.

Les 3 autres départements présentent de plus grandes variations, avec une chute du recrutement plus importante que la moyenne en 2020, mais des augmentations pour 2021 et 2022 plus importantes avec un gain entre 2019 et 2022 autours des 33%. Cette progression est d'autant plus marquée pour le département des Bouches-du-Rhône. On peut donc supposer que ce sont principalement ces 3 département qui dépendent du tourisme dans la région.

Faire des Cartes :

introduction carte : 100 mots

```{r}
mapReg <- left_join(mapdata, reg_dep, by = c("region" = "nom_departement"))
```

méthode 50 mots

```{r}
#selection indicateurs
indD_now_dep <- filter(synthese_departemental, mesure == "Réduire la mortalité sur les routes")

#Join des deux tableaux
mapdataD_now_dep <- left_join(mapdata, indD_now_dep, by = c("region" = "libelle_departement"))

mapD_now_dep <- ggplot(mapdataD_now_dep, aes(x=long, y=lat, group=group)) +
  geom_polygon(aes(fill=valeur_actuelle),color = "black") + scale_fill_gradient(name="nombre de morts",low="green",high="red",na.value="gray")+
  labs(title = "Mortalité sur les routes en 2022, par département ")

plotly::ggplotly(mapD_now_dep)
```

résultats 100 mots

```{r}
mapD_for_dep <- ggplot(mapdataD_now_dep, aes(x=long, y=lat, group=group)) +
  geom_polygon(aes(fill=valeur_initiale),color = "black") + scale_fill_gradient(name="nombre de morts",low="green",high="red",na.value="gray")+
  labs(title = "Mortalité sur les routes en 2017, par département ")

plotly::ggplotly(mapD_for_dep)
```

résultats 100 mots

```{r}
indD_reg <- filter(synthese_regional, mesure == "Réduire la mortalité sur les routes")

regD <- left_join(mapReg, indD_reg, by = c("nom_region" = "libelle_region"))

mapD_now_reg <- ggplot(regD, aes(x=long, y=lat, group=group)) +
  geom_polygon(aes(fill=valeur_actuelle),color = "black")+ 
  scale_fill_gradient(name="nombre de morts",low="green",high="red",na.value="gray")+
  labs(title = "Mortalité sur les routes en 2022, par région ")

plotly::ggplotly(mapD_now_reg)
```

méthodes et résultats 200 mots

```{r}
mapD_for_reg <- ggplot(regD, aes(x=long, y=lat, group=group)) +
  geom_polygon(aes(fill=valeur_initiale),color = "black")+ 
  scale_fill_gradient(name="nombre de morts",low="green",high="red",na.value="gray")+
  labs(title = "Mortalité sur les routes en 2022, par région ")

plotly::ggplotly(mapD_for_reg)
```

résultats 100 mots

```{r}
indCYC_now_dep <- filter(synthese_departemental, indicateur == "Kilomètres d'aménagements cyclables sécurisés")

#Join des deux tableaux
mapdataCYC_now_dep <- left_join(mapdata, indCYC_now_dep, by = c("region" = "libelle_departement"))

mapCYC_now_dep <- ggplot(mapdataCYC_now_dep, aes(x=long, y=lat, group=group)) +
  geom_polygon(aes(fill=valeur_actuelle),color = "black")+ 
  scale_fill_gradient(name="kilomètres",low="brown",high="chartreuse",na.value="gray")+
  labs(title = "Km d'aménagement cyclables sécurisés en 2022, par département ")

#mapSDF_now_dep
plotly::ggplotly(mapCYC_now_dep)

mapCYC_for_dep <- ggplot(mapdataCYC_now_dep, aes(x=long, y=lat, group=group)) +
  geom_polygon(aes(fill=valeur_initiale),color = "black")+ 
  scale_fill_gradient(name="kilomètres",low="brown",high="chartreuse",na.value="gray")+
  labs(title = "Km d'aménagement cyclables sécurisés en 2017, par département")

plotly::ggplotly(mapCYC_for_dep)
```

interpretation 200 mots

```{r}
indCYC_now_reg <- filter(synthese_regional, indicateur == "Kilomètres d'aménagements cyclables sécurisés")

regCYC_now_reg <- left_join(mapReg, indCYC_now_reg, by = c("nom_region" = "libelle_region"))

mapCYC_now_reg <- ggplot(regCYC_now_reg, aes(x=long, y=lat, group=group)) +
  geom_polygon(aes(fill=valeur_actuelle),color = "black")+ 
  scale_fill_gradient(name="kilomètre",low="brown",high="chartreuse",na.value="gray")+
  labs(title = "Km d'aménagement cyclables sécurisés en 2022, par région")

plotly::ggplotly(mapCYC_now_reg)

mapCYC_for_reg <- ggplot(regCYC_now_reg, aes(x=long, y=lat, group=group)) +
  geom_polygon(aes(fill=valeur_initiale),color = "black")+ 
  scale_fill_gradient(name="kilomètres",low="brown",high="chartreuse",na.value="gray")+
  labs(title = "Km d'aménagement cyclables sécurisés en 2017, par région")

plotly::ggplotly(mapCYC_for_reg)
```

interpretation 200 mots

```{r}
indELEC_now_dep <- filter(synthese_departemental, indicateur == "Nombre de bornes de recharge pour véhicules électriques déployées")

#Join des deux tableaux
mapdataELEC_now_dep <- left_join(mapdata, indELEC_now_dep, by = c("region" = "libelle_departement"))

mapELEC_now_dep <- ggplot(mapdataELEC_now_dep, aes(x=long, y=lat, group=group)) +
  geom_polygon(aes(fill=valeur_actuelle),color = "black")+ 
  scale_fill_gradient(name="bornes de recharge",low="darkorange1",high="blue",na.value="gray")+
  labs(title = "Bornes de recharge électriques déployées en 2022, par département ")

#mapSDF_now_dep
plotly::ggplotly(mapELEC_now_dep)

mapELEC_for_dep <- ggplot(mapdataELEC_now_dep, aes(x=long, y=lat, group=group)) +
  geom_polygon(aes(fill=valeur_initiale),color = "black")+ 
  scale_fill_gradient(name="bornes de recharge",low="darkorange1",high="blue",na.value="gray")+
  labs(title = "Bornes de recharge électriques déployées en 2019, par département")

plotly::ggplotly(mapELEC_for_dep)

indELEC_now_reg <- filter(synthese_regional, indicateur == "Nombre de bornes de recharge pour véhicules électriques déployées")


regELEC_now_reg <- left_join(mapReg, indELEC_now_reg, by = c("nom_region" = "libelle_region"))

mapELEC_now_reg <- ggplot(regELEC_now_reg, aes(x=long, y=lat, group=group)) +
  geom_polygon(aes(fill=valeur_actuelle),color = "black")+ 
  scale_fill_gradient(name="bornes de recharge",low="darkorange1",high="blue",na.value="gray")+
  labs(title = "Bornes de recharge électriques déployées en 2022, par région")

plotly::ggplotly(mapELEC_now_reg)

mapELEC_for_reg <- ggplot(regELEC_now_reg, aes(x=long, y=lat, group=group)) +
  geom_polygon(aes(fill=valeur_initiale),color = "black")+ 
  scale_fill_gradient(name="bornes de recharge",low="darkorange1",high="blue",na.value="gray")+
  labs(title = "Bornes de recharge électriques déployées en 2019, par région")

plotly::ggplotly(mapELEC_for_reg)

```

interpretation 300 mots

```{r}
indSDF_now_dep <- filter(synthese_departemental, indicateur == "Nombre de personnes sans-abri ou en hébergement ayant obtenu un logement social")

#Join des deux tableaux
mapdataSDF_now_dep <- left_join(mapdata, indSDF_now_dep, by = c("region" = "libelle_departement"))

mapSDF_now_dep <- ggplot(mapdataSDF_now_dep, aes(x=long, y=lat, group=group)) +
  geom_polygon(aes(fill=valeur_actuelle),color = "black")+ 
  scale_fill_gradient(name="personnes dans l'année",low="cadetblue1",high="brown2",na.value="gray")+
  labs(title = "Sans-abri obtenant un logement social en 2022, par département")

#mapSDF_now_dep
plotly::ggplotly(mapSDF_now_dep)

mapSDF_for_dep <- ggplot(mapdataSDF_now_dep, aes(x=long, y=lat, group=group)) +
  geom_polygon(aes(fill=valeur_initiale),color = "black")+ 
  scale_fill_gradient(name="personnes dans l'année",low="cadetblue1",high="brown2",na.value="gray")+
  labs(title = "Sans-abri obtenant un logement social en 2021, par département")

plotly::ggplotly(mapSDF_for_dep)

indSDF_now_reg <- filter(synthese_regional, indicateur == "Nombre de personnes sans-abri ou en hébergement ayant obtenu un logement social")


regSDF_now_reg <- left_join(mapReg, indSDF_now_reg, by = c("nom_region" = "libelle_region"))

mapSDF_now_reg <- ggplot(regSDF_now_reg, aes(x=long, y=lat, group=group)) +
  geom_polygon(aes(fill=valeur_actuelle),color = "black")+ 
  scale_fill_gradient(name="personnes dans l'année",low="cadetblue1",high="brown2",na.value="gray")+
  labs(title = "Sans-abri obtenant un logement social en 2022, par région")

plotly::ggplotly(mapSDF_now_reg)

mapSDF_for_reg <- ggplot(regSDF_now_reg, aes(x=long, y=lat, group=group)) +
  geom_polygon(aes(fill=valeur_initiale),color = "black")+ 
  scale_fill_gradient(name="personnes dans l'année",low="cadetblue1",high="brown2",na.value="gray")+labs(title = "Sans-abri obtenant un logement social en 2021, par région")

plotly::ggplotly(mapSDF_for_reg)
```

interpretation 300 mots
