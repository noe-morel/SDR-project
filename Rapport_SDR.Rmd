---
title: "Rapport SDR"
output: html_document
date: "2024-01-19"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)

library(plotly)

```

## IMPORT des données

```{r import}
detail_departemental <- readr::read_delim("barometre-resultats-detail-departemental.csv", delim = ",", trim_ws = TRUE, show_col_types = FALSE)
detail_regional <- readr::read_delim("barometre-resultats-detail-regional.csv", delim = ",", trim_ws = TRUE, show_col_types = FALSE)
detail_national <- readr::read_delim("barometre-resultats-detail-national.csv", delim = ",", trim_ws = TRUE, show_col_types = FALSE)
synthese_departemental <- readr::read_delim("barometre-resultats-synthese-departemental.csv", delim = ",", trim_ws = TRUE, show_col_types = FALSE)
synthese_regional <- readr::read_delim("barometre-resultats-synthese-regional.csv", delim = ",", trim_ws = TRUE, show_col_types = FALSE)
synthese_national <- readr::read_delim("barometre-resultats-synthese-national.csv", delim = ",", trim_ws = TRUE, show_col_types = FALSE)

reg_dep <- readr::read_delim("departements-france.csv", delim = ",", trim_ws = TRUE, show_col_types = FALSE)

reg_dep$nom_departement <- gsub("ô","o",reg_dep$nom_departement)


reg_dep$nom_departement <- iconv(reg_dep$nom_departement,to="ASCII//TRANSLIT")
reg_dep$nom_departement <- gsub("'","",reg_dep$nom_departement)
reg_dep$nom_departement <- gsub("`","",reg_dep$nom_departement)
reg_dep$nom_departement <- tolower(reg_dep$nom_departement)
reg_dep$nom_departement <- tolower(gsub(' ','-',reg_dep$nom_departement))

reg_dep$nom_region <- gsub("ô","o",reg_dep$nom_region)


reg_dep$nom_region <- iconv(reg_dep$nom_region,to="ASCII//TRANSLIT")
reg_dep$nom_region <- gsub("'","",reg_dep$nom_region)
reg_dep$nom_region <- gsub("`","",reg_dep$nom_region)
reg_dep$nom_region <- tolower(reg_dep$nom_region)
reg_dep$nom_region <- tolower(gsub(' ','-',reg_dep$nom_region))


mapdata <- map_data("france")
mapdata$region <- tolower(gsub(' ','-',mapdata$region))

synthese_departemental$libelle_departement <- gsub("ô","o",synthese_departemental$libelle_departement)

synthese_departemental$libelle_departement <- iconv(synthese_departemental$libelle_departement,to="ASCII//TRANSLIT")
synthese_departemental$libelle_departement <- gsub("'","",synthese_departemental$libelle_departement)
synthese_departemental$libelle_departement <- gsub("`","",synthese_departemental$libelle_departement)
synthese_departemental$libelle_departement <- tolower(synthese_departemental$libelle_departement)
synthese_departemental$libelle_departement <- tolower(gsub(' ','-',synthese_departemental$libelle_departement))

detail_departemental$libelle_departement <- iconv(detail_departemental$libelle_departement,to="ASCII//TRANSLIT")
detail_departemental$libelle_departement <- gsub("'","",detail_departemental$libelle_departement)
detail_departemental$libelle_departement <- tolower(detail_departemental$libelle_departement)
detail_departemental$libelle_departement <- tolower(gsub(' ','-',detail_departemental$libelle_departement))

synthese_regional$libelle_region <- gsub("ô","o",synthese_regional$libelle_region)
synthese_regional$libelle_region <- iconv(synthese_regional$libelle_region,to="ASCII//TRANSLIT")
synthese_regional$libelle_region <- gsub("'","",synthese_regional$libelle_region)
synthese_regional$libelle_region <- gsub("`","",synthese_regional$libelle_region)
synthese_regional$libelle_region <- tolower(synthese_regional$libelle_region)
synthese_regional$libelle_region <- tolower(gsub(' ','-',synthese_regional$libelle_region))
```

## Introduction aux données : 

Le jeu de données sélectionné est le « Baromètre des résultats de l\'action publique ». Il représente les résultats liés à 8 thématiques sur lesquelles le gouvernement s\'est engagé. Ces thématiques sont : 

-   L\'éducation et la jeunesse

-   L\'économie et l\'emploi

-   La Transition écologique

-   L\'Agriculture

-   La sécurité

-   La justice

-   La santé, la famille et l\'handicap

-   Le Logement

-   Les services publics et les territoires

-   La culture et les sports

Ainsi pour chaque thématique, de nombreuses mesures sont données. Et pour chacune de ces mesures, un unique indicateur est fourni. Cet indicateur est décliné à l\'échelle nationale, régionale et départementale.

De plus on a pour chaque indicateur, sa valeur entre une date initiale (au plus tôt 2017) et sa valeur cible en 2022. 

Ce jeu de données était donc très intéressant du fait que l\'on puisse observer les évolutions temporelles, mais aussi les disparités géographiques et l\'impact du changement d\'échelle. Ce qui permet des visualisations très diverses et donc intéressantes. 

Nous commencerons par une analyse approfondie d\'une mesure (le Plan 1 jeune 1 solution), puis nous évaluerons les différences géographique à l\'aide de cartes. 

## Utilisation de Git : 

Afin de pouvoir tous travailler en simultané sur le Dashboard et le Rapport, nous avons décidé de versionner le projet grâce à Git. C\'était la première fois que nous utilisions Git sur R, et cela a été plutôt concluant et nous a permis de travailler ensemble. 

## Plan 1 jeune 1 solution

Dans cette partie, nous allons nous concentrer sur la mise en place du plan 1 jeune 1 solution mis en place à partir de l'été 2020.

Ce plan gouvernemental a pour objectif d'améliorer l'insertion des jeunes dans la vie professionnelle. Pour atteindre cet objectif, le plan se concentre sur 3 axes :

-Faciliter l'entrée dans la vie professionnelle avec des aides pour les employeurs qui recrutent des jeunes, des aides plus importantes sont aussi disponibles pour les contrats d'apprentissages. A cela s'ajoute la création de mission de service civique rémunérée et de métiers dans le secteur du sport.

-Orienter et former les jeunes, à l'aide de parcours de formations qualifiants et professionnalisants.

-Proposer un accompagnement plus personnalisé pour les jeunes en difficultés.

Pour mesurer l'impact des mesures mises en place, notre base de données à choisi comme indicateur le nombre de jeune recrutés. Ainsi, pour chaque mois depuis août 2019, on a accès au nombre de jeune recrutés depuis le dernier mois d'août.

Afin d'étudier l'impact de ce plan à différentes échelles, nous allons effectuer un zoom progressif aux différentes échelles disponibles afin d'interpréter ces nombres.

Pour la première étape, nous allons étudier les chiffres à l'échelle nationale. Pour cela nous allons tracer le nombre de jeune recruter depuis le mois d'août dernier pour chaque mois depuis août 2019 à fin 2022 (information donnée par la base de données), mais aussi le nombre de jeunes recrutés par mois, afin de pouvoir suivre une progression continue.

Afin d'obtenir le nombre de recruter par mois, nous avons créé une nouvelle colonne qui prends pour valeur la différence du nombre de personne recruter depuis août pour un mois et qui fait la différence avec la valeur du mois précédent.

```{r 1 jeune 1 solution National}

UnJeuneNational <- detail_national |>
  filter(mesure=="Plan 1 jeune 1 solution") |>
  mutate(recrutés_par_mois = if_else(valeur>lag(valeur), valeur-lag(valeur), valeur, missing=valeur))|>
  rename(recrutés_cumulés = valeur) |>
  pivot_longer(c(recrutés_cumulés, recrutés_par_mois), names_to = "type", values_to = "valeur") |>
  mutate(year = year(date)) |>
  ggplot() + 
  geom_line(mapping=aes(x=date, y=valeur, fg=type)) +
  labs(title = "Jeunes recrutés grâce au projet",
       x = "Date",
       y = "Nombre de recrutement",
       fg="")


plotly::ggplotly(UnJeuneNational)


```

Tout d'abord, on peut très rapidement repérer une saisonnalité importante grâce à la courbe de recrutement par mois. En effet, chaque année, le nombre de jeune recruté pendant le mois de septembre est très important par rapport au reste de l'année. Cette période de fort recrutement des jeunes peut sans doute être expliquer par le fait que le début d'année pour les jeunes et en septembre, ainsi de nombreux contrats d'apprentissages doivent commencer en septembre.

Ensuite, en regardant les pics de chaque année (donc le mois de juillet de chaque année), on peut remarquer une baisse du recrutement des jeunes en 2020. Cette chute est surement due à la crise COVID. Cette interprétation est corroborée par la chute observée autour d'avril 2020, le début de la crise COVID.

Après la grosse chute de recrutement mensuel causé par la crise, on observe une forte augmentation du recrutement à l'été 2020, cela coïncide avec le début du plan 1 jeune 1 solution. Il est donc raisonnable de supposer que ce plan à permis de neutralisé l'impact de la crise sur le recrutement des jeunes. Ainsi on observe une remontée du nombre de recrutement pour 2021 au niveau de celui de 2019.

L'augmentation continue ensuite pour 2022. On peut donc supposer qu'à l'échelle nationale, le plan a eu des conséquences positives sur le recrutement des jeunes.

Regardons maintenant à l'échelle régionale, pour chaque année, pour voir si l'on retrouve la même progression annuelle.

```{r 1 jeune 1 solution Regions, fig.width=14}

UnJeuneNational <- detail_regional |>
  filter(mesure=="Plan 1 jeune 1 solution" & month(date)==7) |>
  mutate(year = year(date)) |>
  ggplot() + 
  geom_col(mapping = aes(x=libelle_region, y=valeur, bg=libelle_region))+
  theme(axis.text.x=element_blank(),axis.ticks.x=element_blank(),axis.title.x=element_blank())+
  facet_wrap(vars(year), nrow=1)+
  labs(title = "Jeunes recrutés grâce au projet par région",
       x = "Date",
       y = "Nombre de recrutement",
       bg="Région")

plotly::ggplotly(UnJeuneNational)

```

Tout d'abord on peut remarquer que l'Île de France est une très grande région recruteuse de jeunes, mais c'est aussi la région la plus peuplée de France, ces chiffres sont donc à relativiser. Ensuite, pour chaque région on peut retrouver une chute du recrutement pour l'année 2021, comme pour la tendance nationale. On peut remarquer aussi que le nombre de jeune recruté à Mayotte est de 0 (et pas NA). Cependant il est très peu probable qu'aucun jeune ait trouvé un emploi à la réunion à Mayotte pendant 4 année de suite, cette information est donc sans doute manquante.

En raison des fortes disparités de population en fonction de la région, ce graphe ne nous permet pas de faire des observations précises. Ainsi pour offrir un autre point de vue, nous avons décidé de représenter le pourcentage d'évolution du recrutement entre chaque année, en enlevant Mayotte qui ne présente donc pas d'informations.

```{r 1 jeune 1 solution Regions, fig.width=14}

UnJeuneNationalPC <- detail_regional |>
  filter(mesure=="Plan 1 jeune 1 solution" & month(date)==7 & code_region!="06") |>
  mutate(year = year(date)) |>
  mutate(valeur_pc = if_else(year!=2019, 100+(valeur-lag(valeur))/lag(valeur)*100, 100))|>
  ggplot() + 
  geom_col(mapping = aes(x=libelle_region, y=valeur_pc, bg=libelle_region))+
  theme(axis.text.x=element_blank(),axis.ticks.x=element_blank(),axis.title.x=element_blank())+
  facet_wrap(vars(year), nrow=1)+
  labs(title = "Jeunes recrutés grâce au projet par région",
       x = "Date",
       y = "Nombre de recrutement",
       bg="Région")

plotly::ggplotly(UnJeuneNationalPC)
```

Sur ce graphe, on a donc toutes les régions à 100 en 2019 (nous n'avons pas les chiffres de juillet 2018, donc on ne peut pas les comparer à ceux de juillet 2019). Pour les années suivantes, on peut observer l'évolution du recrutement par rapport à l'année précédente par région.

Comme on le savait déjà, toutes les régions ont subi une baisse du recrutement en 2020, cette baisse est d'autant plus marquée pour les régions Corse, Guyane, Martinique et Provence-Alpes-Côte-d'Azur. Ces régions sont des régions très dépendantes du tourisme, surtout en période estivale. Elles ont donc été fortement impactées par le confinement d'Avril-Mai 2020, ce qui a sans doute causé ces chutes importantes.

De plus, en 2021, les régions qui ont vu leur recrutement le plus progresser sont de même les régions d'Outre-Mer et la Corse. On peut donc supposer que ce même facteur du tourisme, ayant repris à pleine intensité en 2021 soit la cause de cette augmentation. A l'inverse, la région Île-de-France est la seule n'ayant pas progresser durant cette année.

Pour 2022, les chiffres des régions des départements d'Outre-Mer sont moins importants, même s'ils continuent d'augmenter malgré leur très forte augmentation l'année précédente. Sur la même période, toutes les régions de la métropole voient leur chiffre augmenté, avec des valeurs proches sur tout le territoire, avec des chiffres plus importants pour la région Auvergne-Rhône-Alpes, l'Île-de-France et la région PACA.

Pour continuer l'analyse à un niveau départementale, nous avons décidé de nous concentrer sur la région PACA qui présente beaucoup de variations et des chiffres importants. Nous allons donc tracer la valeur mensuelle du recrutement en région PACA.

```{r 1 jeune 1 solution region IdF}

UnJeunePACA <- detail_regional |>
  filter(mesure=="Plan 1 jeune 1 solution" & code_region=="93") |>
  mutate(valeur_mois = if_else(valeur>lag(valeur), valeur-lag(valeur), valeur, missing=valeur))|>
  mutate(year = year(date)) |>
  ggplot() + 
  geom_line(mapping=aes(x=date, y=valeur_mois)) +
  labs(title = "Jeunes recrutés grâce au projet en région PACA",
       x = "Date",
       y = "Nombre de recrutement")

plotly::ggplotly(UnJeunePACA)


```

Tout d'abord, nous pouvons remarquer une différence avec l'évolution nationale. Pour la progression nationale, les chiffres de recrutement sont a peu prêt constant sur la période décembre-juin, alors que pour la région PACA, on observe une première augmentation du recrutement dès le mois d'avril. Cela est sans doute dû à l'activité saisonnière de la région. La crise du COVID à donc fortement impacté la région, le nombre de recrutement en avril ayant été extremement bas par rapport à la normale.

Même si l'on pourrait croire que le pic de septembre 2020 n'a pas été beaucoup impacté par la crise car il ne présente pas d'évolution significative, on peut remarquer que les autres pics sont tous alignés et suivent donc une tendance claire que celui de 2020 ne suit pas.

Cette dernière observation nous pousse d'ailleurs à nous demander si le plan d'action du gouvernement à réellement un impact sur le recrutement des jeunes. En effet si les chiffres du recrutement semblent suivre la même évolution avant et après 2021, on peut se demander si le plan réellement une utilité, même s'il a peut-être aider à la reprise de l'activité.

Pour finir cette analyse, nous allons regarder l'évolution du nombre de recrutement par an par département, toujours dans la région PACA. Pour offrir un outil de comparaison, nous affichons en même temps en noir la courbe d'évolution nationale.

```{r 1 jeune 1 solution départements IdF}

test <- detail_departemental |>
  filter(month(date)==7 & mesure=="Plan 1 jeune 1 solution")|>
  mutate(year = year(date))|>
  group_by(year)|>
  mutate(moyenne = mean(valeur))

UnJeuneDepPACA <- detail_departemental |>
  left_join(reg_dep, by = c("code_departement"="code_departement"))|>
  filter(mesure=="Plan 1 jeune 1 solution" & month(date)==7)|>
  add_column(moyenne = test$moyenne) |>
  filter(code_region=="93")|>
  mutate(year = year(date)) |>
  ggplot() + 
  geom_line(mapping=aes(x=year(date), y=valeur, fg = libelle_departement))+
  geom_line(mapping = aes(x = year(date), y=moyenne))  +
  labs(title = "Jeunes recrutés grâce au projet en PACA par département",
       x = "Date",
       y = "Nombre de recrutement",
       fg="Département")


plotly::ggplotly(UnJeuneDepPACA)

```

Tout d'abord, on peut voir que 2 départements, les Hautes-Alpes et les Alpes-de-Haute-Provence se démarquent par leur faible recrutement de jeunes. Ces mêmes départements présentent une très faible évolution de leur nombre de recrutement.

L'évolution des recrutements du Vaucluse est très proche de l'évolution nationale, même si pour des chiffres moins importants. Cette évolution nationale présente évidement une chute en 2020, et une progression sur 4 ans de 25%.

Les 3 autres départements présentent de plus grandes variations, avec une chute du recrutement plus importante que la moyenne en 2020, mais des augmentations pour 2021 et 2022 plus importantes avec un gain entre 2019 et 2022 autours des 33%. Cette progression est d'autant plus marquée pour le département des Bouches-du-Rhône. On peut donc supposer que ce sont principalement ces 3 département qui dépendent du tourisme dans la région.

## Visualisation sous forme de cartes : 

Après avoir visualisé des données à l\'aide de graphes usuels, nous avons réfléchi à implémenter une représentation visuelle différente et plus adaptée à notre problème. Étant donné que tous nos résultats étaient dépendant d\'un endroit géographique que ce soit national, en fonction des régions ou en fonction des départements, la mise en place de cartes a donc semblé naturelle. Afficher les résultats sous forme de cartes en fonction des régions ou en fonction des départements permettrait d\'avoir une vision plus facile et naturelle de l\'ensemble des résultats et également de voir les effets de voisinage que les résultats pouvaient engendrés. En effet nous nous attendions a retrouvé des masses groupées de départements par exemple ou des clivages Nord/Sud. 

Pour cela nous avons commencé par chercher dans la cheat sheet de ggplot2 et nous avons trouvé une fonction *mapdata.* Cette fonction après étude permettait de fournir des tables de différents pays. Le nombre de pays est très restreint, mais la France y est présente. Ainsi nous avons pu avoir un tableau constitué des latitudes et longitudes des département ainsi que leur nom. En revanche il n\'y avait pas ni les noms des régions ni les coordonnées des régions. 

Nous avons alors décidé dans un premier temps de visualiser un indicateur en fonction des départements. Pour cela nous avons filtré le document synthétique des département pour ne conserver que les lignes correspondantes à cet indicateur, nous avons ensuite joint ces données avec les données de *mapdata*, ensuite nous avons représenté cette carte grâce à la fonction *polygon* qui permet de prendre des latitudes et longitudes en argument. 

```{r}
mapReg <- left_join(mapdata, reg_dep, by = c("region" = "nom_departement"))
```

#### Mortalité sur les routes : 

```{r}
#selection indicateurs
indD_now_dep <- filter(synthese_departemental, mesure == "Réduire la mortalité sur les routes")

#Join des deux tableaux
mapdataD_now_dep <- left_join(mapdata, indD_now_dep, by = c("region" = "libelle_departement"))

mapD_now_dep <- ggplot(mapdataD_now_dep, aes(x=long, y=lat, group=group)) +
  geom_polygon(aes(fill=valeur_actuelle),color = "black") + scale_fill_gradient(name="nombre de morts",low="green",high="red",na.value="gray")+
  labs(title = "Mortalité sur les routes en 2022, par département ")

plotly::ggplotly(mapD_now_dep)
```

Nous avons choisi pour la première carte la mortalité sur la route. 

Cette carte représente la mesure concernant la réduction de la mortalité sur les routes en France. Elle a pour indicateur le nombre de morts sur la route pour une une année donnée et en fonction de chaque département. Nous voyons sur la carte que le département ayant le plus de morts sur la route est les Bouches-du-Rhône avec 87 morts en 2022, tandis que le département le moins enclin à la mortalité sur les routes est le Lot avec seulement 5 morts en 2022. On remarque que les littoraux sont globalement les plus touchés, le littoral méditerranéen, atlantique et la manche. Mais la région lyonnaise est également assez touchée. La région parisienne a des valeurs plutôt moyennes, ce qui est assez étonnant, du fait de sa large population. Cela s\'explique surement par son urbanisation quasi-totale. De plus les zones où la mortalité est la plus faible sont également les zones où la population est la moins élevée ce qui paraît cohérent. 

```{r}
mapD_for_dep <- ggplot(mapdataD_now_dep, aes(x=long, y=lat, group=group)) +
  geom_polygon(aes(fill=valeur_initiale),color = "black") + scale_fill_gradient(name="nombre de morts",low="green",high="red",na.value="gray")+
  labs(title = "Mortalité sur les routes en 2017, par département ")

plotly::ggplotly(mapD_for_dep)
```

Cette fois ci, la carte représente les même données mais en 2017 soit 7 ans avant la carte précédente. Cette fois ci le département ayant le plus de morts est encore une fois les Bouches-du-Rhône avec 122 morts sur les routes, tandis le département le moins enclin à la mortalité n\'est plus le Lot mais la Lozère avec 8 morts en 2017. On retrouve ici les même gradient de mortalités. Les littoraux demeurent les plus touchés, tout comme la région lyonnaise. En revanche la région Parisienne (surtout à cause de la Seine-et-Marne) est beaucoup plus touchées qu\'en 2022. Encoure une fois les régions les moins peuplées sont les moins touchées. On remarque cependant qu\'il y a eu une forte diminution du nombre de morts sur les routes depuis 2017 en effet la les valeurs les plus hautes ont diminuées de plus de 30% en 7 ans. La mesure du gouvernement a donc été respectée. 

```{r}
indD_reg <- filter(synthese_regional, mesure == "Réduire la mortalité sur les routes")

regD <- left_join(mapReg, indD_reg, by = c("nom_region" = "libelle_region"))

mapD_now_reg <- ggplot(regD, aes(x=long, y=lat, group=group)) +
  geom_polygon(aes(fill=valeur_actuelle),color = "black")+ 
  scale_fill_gradient(name="nombre de morts",low="green",high="red",na.value="gray")+
  labs(title = "Mortalité sur les routes en 2022, par région ")

plotly::ggplotly(mapD_now_reg)
```

Nous avons déjà observé toutes les données par département, mais il pourrait être judicieux de prendre de la hauteur et observer les données à une échelles plus grande. Pour réaliser cela nous avons décidé d\'observer les mêmes données mais par région et non plus par département, afin de voir les différences notables. Ainsi il a fallu modifier le tableau regroupant toutes les latitudes et longitudes des départements afin de leur rajouter pour chaque la région associée. Nous avons donc importer un tableau regroupant tous les département et leur région associée et l\'avons joint à notre *mapdata* précédent.

La première observation correspond à la mortalité sur les routes en 2022 mais cette fois-ci par région. Nous notons d\'emblée des différences majeures entre la carte des départements et celles des régions. La région la plus mortelle est la région Auvergne-Rhône-Alpes qui présente 317 morts, suivi de près par la Nouvelle Aquitaine avec 312. Bien que ces deux régions présentaient des départements à hauts-risque, ces département n\'étaient pas les plus élevés, et ces deux régions avaient également les plus faibles départements. Cela peut sûrement s\'expliquer par le nombre d\'habitants dans ces deux régions (respectivement 8 et 6 millions), la deuxième et troisième région les plus peuplée. De même la région avec le moins de morts est la Corse avec 42 qui est expliquée par sa population de 350 000 habitants la rendant la région la moins peuplée. En revanche Paris et sa région sont dans la moyenne avec 209 morts alors qu\'il s\'agit de la région la plus peuplée, cela peut certainement s\'expliquer par sa petite superficie qui limite les accidents. 

```{r}
mapD_for_reg <- ggplot(regD, aes(x=long, y=lat, group=group)) +
  geom_polygon(aes(fill=valeur_initiale),color = "black")+ 
  scale_fill_gradient(name="nombre de morts",low="green",high="red",na.value="gray")+
  labs(title = "Mortalité sur les routes en 2017, par région ")

plotly::ggplotly(mapD_for_reg)
```

Cette nouvelle carte propose de représenter ces mêmes régions mais en 2017. En comparant avec la carte précédente on observe encore une fois une baisse des morts sur la route depuis 2017. La région la plus mortelle reste l\'Auvergne-Rhône-Alpes avec 410 morts en 2017, mais la deuxième place passe à l\'Occitane avec 392. Tandis que Paris est beaucoup plus haute qu\'en 2022 avec 319 morts sur les routes. La région avec la plus nette baisse entre 2022 et 2017 est la région Provence-Alpes-Cotes-D\'Azur avec une baisse de plus de 110 morts par an sur les routes ce qui est plutôt remarquable. 

#### Aménagements cyclables : 

```{r}
indCYC_now_dep <- filter(synthese_departemental, indicateur == "Kilomètres d'aménagements cyclables sécurisés")

#Join des deux tableaux
mapdataCYC_now_dep <- left_join(mapdata, indCYC_now_dep, by = c("region" = "libelle_departement"))

mapCYC_now_dep <- ggplot(mapdataCYC_now_dep, aes(x=long, y=lat, group=group)) +
  geom_polygon(aes(fill=valeur_actuelle),color = "black")+ 
  scale_fill_gradient(name="kilomètres",low="brown",high="chartreuse",na.value="gray")+
  labs(title = "Km d'aménagement cyclables sécurisés en 2022, par département ")

#mapSDF_now_dep
plotly::ggplotly(mapCYC_now_dep)

mapCYC_for_dep <- ggplot(mapdataCYC_now_dep, aes(x=long, y=lat, group=group)) +
  geom_polygon(aes(fill=valeur_initiale),color = "black")+ 
  scale_fill_gradient(name="kilomètres",low="brown",high="chartreuse",na.value="gray")+
  labs(title = "Km d'aménagement cyclables sécurisés en 2017, par département")

plotly::ggplotly(mapCYC_for_dep)
```

Les cartes désormais étudiées correspondent à la mesure voulant déployer l\'utilisation du vélo. Son indicateur représente le nombre de kilomètres d\'aménagement cyclables sécurisés. La première carte représente cet indicateur en fonction des départements en 2017. On observe que seulement une toute petite partie du territoire français présente de nombreuses pistes cyclables. La Gironde mêne la marche avec 2117 km de pistes cyclables tandis que la Creuse ne présente qu\'un kilomètre de piste cyclable aménagé. Le littoral atlantique est relativement bien aménagé avec environ 1000km par département tandis que le centre de la France et la diagonale du vide ont 50km ou moins par département. Nous observons également que le littoral de la Manche est relativement bien desservi alors que le littoral méditerranéen beaucoup moins malgré son attrait touristique. 

La même carte en 2022 montre quelques changements. Bien que la Gironde reste en tête avec 2069km aménagés, le Nord n\'est pas loin derrière. La Creuse, quant à elle, reste dernière avec 5km aménagés (ce qui représente tout de même cinq fois plus qu\'en 2017). Nous remarquons que tout le littoral Atlantique a largement investi dans la mise en place de pistes cyclables, ce qui lui donne les devant par rapport au reste de la France. Tandis que le centre de la France reste très loin derrière avec la Corse. Cependant il est a noté une hausse générale et assez massive du nombre de pistes cyclables aménagées environ 25% pour la plupart des départements. 

```{r}
indCYC_now_reg <- filter(synthese_regional, indicateur == "Kilomètres d'aménagements cyclables sécurisés")

regCYC_now_reg <- left_join(mapReg, indCYC_now_reg, by = c("nom_region" = "libelle_region"))

mapCYC_now_reg <- ggplot(regCYC_now_reg, aes(x=long, y=lat, group=group)) +
  geom_polygon(aes(fill=valeur_actuelle),color = "black")+ 
  scale_fill_gradient(name="kilomètre",low="brown",high="chartreuse",na.value="gray")+
  labs(title = "Km d'aménagement cyclables sécurisés en 2022, par région")

plotly::ggplotly(mapCYC_now_reg)

mapCYC_for_reg <- ggplot(regCYC_now_reg, aes(x=long, y=lat, group=group)) +
  geom_polygon(aes(fill=valeur_initiale),color = "black")+ 
  scale_fill_gradient(name="kilomètres",low="brown",high="chartreuse",na.value="gray")+
  labs(title = "Km d'aménagement cyclables sécurisés en 2017, par région")

plotly::ggplotly(mapCYC_for_reg)
```

Nous nous intéressons maintenant au même indicateur mais cette fois ci pour les régions. En 2017, nous observons des résultats cohérents avec ceux précédents. La région Nouvelle-Aquitaine, menée par la Gironde est la plus desservie en terme d\'aménagement cyclables avec 5548km de pistes cyclables. Cette région est très loin devant la Corse qui n\'a que 19km d\'aménagement cyclable. Cela s\'explique bien entendue par la taille de l\'île, de son nombre d\'habitant, mais également de sa topologie présentant de forts reliefs. La région Grand-Est est très proche de la Nouvelle-Aquitaine. Cela s\'explique par un très fort aménagement cyclable dans la Moselle et le Bas-Rhin. La région Parisienne est relativement basse en étant la 5e région de France, ce qui pourrait paraître étonnant, mais qui s\'explique par sa taille. 

En observant la deuxième carte, des régions en 2022, nous pouvons d\'emblée constater l\'évolution très rapide du nombre de kilomètres d\'aménagement cyclable sécurisés. En effet, les régions les plus hautes, comme la Nouvelle-Aquitaine ou le Grand-Est voient leurs effectif passer à 7432 et 7108, soit presque 2000 km de plus en 7 ans. La Corse reste loin derrière avec 59 km (le triple qu\'en 2017 néanmoins). Enfin, les régions Hauts-de-France et Pays de la Loire progressent également nettement en sept ans.

#### 
Bornes de recharge pour véhicules électriques : 

```{r}
indELEC_now_dep <- filter(synthese_departemental, indicateur == "Nombre de bornes de recharge pour véhicules électriques déployées")

#Join des deux tableaux
mapdataELEC_now_dep <- left_join(mapdata, indELEC_now_dep, by = c("region" = "libelle_departement"))

mapELEC_now_dep <- ggplot(mapdataELEC_now_dep, aes(x=long, y=lat, group=group)) +
  geom_polygon(aes(fill=valeur_actuelle),color = "black")+ 
  scale_fill_gradient(name="bornes de recharge",low="darkorange1",high="blue",na.value="gray")+
  labs(title = "Bornes de recharge électriques déployées en 2022, par département ")

#mapSDF_now_dep
plotly::ggplotly(mapELEC_now_dep)

mapELEC_for_dep <- ggplot(mapdataELEC_now_dep, aes(x=long, y=lat, group=group)) +
  geom_polygon(aes(fill=valeur_initiale),color = "black")+ 
  scale_fill_gradient(name="bornes de recharge",low="darkorange1",high="blue",na.value="gray")+
  labs(title = "Bornes de recharge électriques déployées en 2019, par département")

plotly::ggplotly(mapELEC_for_dep)

indELEC_now_reg <- filter(synthese_regional, indicateur == "Nombre de bornes de recharge pour véhicules électriques déployées")


regELEC_now_reg <- left_join(mapReg, indELEC_now_reg, by = c("nom_region" = "libelle_region"))

mapELEC_now_reg <- ggplot(regELEC_now_reg, aes(x=long, y=lat, group=group)) +
  geom_polygon(aes(fill=valeur_actuelle),color = "black")+ 
  scale_fill_gradient(name="bornes de recharge",low="darkorange1",high="blue",na.value="gray")+
  labs(title = "Bornes de recharge électriques déployées en 2022, par région")

plotly::ggplotly(mapELEC_now_reg)

mapELEC_for_reg <- ggplot(regELEC_now_reg, aes(x=long, y=lat, group=group)) +
  geom_polygon(aes(fill=valeur_initiale),color = "black")+ 
  scale_fill_gradient(name="bornes de recharge",low="darkorange1",high="blue",na.value="gray")+
  labs(title = "Bornes de recharge électriques déployées en 2019, par région")

plotly::ggplotly(mapELEC_for_reg)

```

Le choix de ce nouvel indicateur s\'est fait à la suite du précédent. Nous voulions voir si les départements et régions de France où les pistes cyclables étaient le plus développées correspondaient également aux régions et départements possédant le plus de bornes de recharges électriques. Ainsi nous pouvions imaginer une volonté de sortie des mobilités polluantes.

La première carte que nous étudions est celle du nombre de bornes de recharge électriques déployées en 2019 par département. On remarque que les trois départements ayant un déploiement le plus importantes sont Paris (1728 bornes), la Gironde (998 bornes) et le Nord (824 bornes). Paris domine donc, ce qui est logique avec la richesse générale de ce département. Cependant les deux autre départements sont cohérents avec la mise en place de pistes cyclables, une effet ils représentent tous les deux les départements les plus couverts d\'aménagements cyclables. Le département possédant le moins de bornes est la Haute-Loire avec 12 bornes. Cela peut s\'expliquer par la géographie agricole d\'un tel département. 

En comparant ces résultats avec ceux de 2022 nous observons une augmentation très élevée du nombre de bornes de recharges déployées, la plupart des départements voyant le nombre au moins doubler. Paris reste loin devant avec 5058 bornes déployées, suivie du Nord (2950 bornes), et de la Gironde (2200). Nous remarquons également une aumentation très grande pour les Bouches-du-Rhônes. Ces augmentations énormes montrent qu\'en moins de trois ans, la présence d\'un parc électrique en France s\'est imposé comme une obligation. En 2022 c\'est le Cantal qui passe dernière avec seulement 95 bornes déployées. On peut donc en déduire que les bornes sont le plus déployées dans les départements possédant une métropole. 

Les cartes des régions montrent également l\'augmentation énorme du nombre de bornes déployées, nous passons d\'un maximum en 2019 pour l\'Ile-de-France de 3936 à plus de 15000 en 2022. Ce qui montre encore la domination de la région Parisienne face aux autres région qui restent loin derrière. Et les régions présentant les plus grosses aires urbaines présentent plus de bornes que les régions avec de plus petites aires urbaines. 

#### 
Logements sociaux :

```{r}
indSDF_now_dep <- filter(synthese_departemental, indicateur == "Nombre de personnes sans-abri ou en hébergement ayant obtenu un logement social")

#Join des deux tableaux
mapdataSDF_now_dep <- left_join(mapdata, indSDF_now_dep, by = c("region" = "libelle_departement"))

mapSDF_now_dep <- ggplot(mapdataSDF_now_dep, aes(x=long, y=lat, group=group)) +
  geom_polygon(aes(fill=valeur_actuelle),color = "black")+ 
  scale_fill_gradient(name="personnes dans l'année",low="cadetblue1",high="orangered",na.value="gray")+
  labs(title = "Sans-abri obtenant un logement social en 2022, par département")

#mapSDF_now_dep
plotly::ggplotly(mapSDF_now_dep)

mapSDF_for_dep <- ggplot(mapdataSDF_now_dep, aes(x=long, y=lat, group=group)) +
  geom_polygon(aes(fill=valeur_initiale),color = "black")+ 
  scale_fill_gradient(name="personnes dans l'année",low="cadetblue1",high="orangered",na.value="gray")+
  labs(title = "Sans-abri obtenant un logement social en 2021, par département")

plotly::ggplotly(mapSDF_for_dep)

indSDF_now_reg <- filter(synthese_regional, indicateur == "Nombre de personnes sans-abri ou en hébergement ayant obtenu un logement social")


regSDF_now_reg <- left_join(mapReg, indSDF_now_reg, by = c("nom_region" = "libelle_region"))

mapSDF_now_reg <- ggplot(regSDF_now_reg, aes(x=long, y=lat, group=group)) +
  geom_polygon(aes(fill=valeur_actuelle),color = "black")+ 
  scale_fill_gradient(name="personnes dans l'année",low="cadetblue1",high="orangered",na.value="gray")+
  labs(title = "Sans-abri obtenant un logement social en 2022, par région")

plotly::ggplotly(mapSDF_now_reg)

mapSDF_for_reg <- ggplot(regSDF_now_reg, aes(x=long, y=lat, group=group)) +
  geom_polygon(aes(fill=valeur_initiale),color = "black")+ 
  scale_fill_gradient(name="personnes dans l'année",low="cadetblue1",high="orangered",na.value="gray")+labs(title = "Sans-abri obtenant un logement social en 2021, par région")

plotly::ggplotly(mapSDF_for_reg)
```

La dernière série de cartes que nous avons sélectionné pour étude est celle du nombre de personnes sans-abris ou en hébergement ayant obtenu un logement social. Avant de regarder les résultats, nous nous attendons à avoir une répartition des résultats très clivée, en ayant beaucoup d\'hébergement dans les plus grandes villes Française (Paris, Lyon, Marseille, Nantes...), et très peu dans les département et régions les moins densément peuplée. Nous pensons également avoir une valeur importante pour les départements du Nord étant donnée la situation d\'attente de migration si déroulant. 

On peut observer dans la première carte des départements en 2021 une importante concentration de personnes obtenant un logement social dans toutes les métropoles françaises. Notamment avec 2420 obtention à Paris, et plus de 1000 obtentions dans les autres grandes villes. Cependant le département présentant le plus haut nombre obtention de logement social est le Nord avec 2702 obtentions. Tout cela est cohérent avec les estimations que nous avions faites avant d\'avoir accès aux résultats. En revanche les Bouches-du-Rhône présentent seulement 1000 obtention ce qui est très loin des autres grandes villes d\'autant plus que Marseille est la deuxième plus grande ville de France. La Lozère est encore une fois dernière avec seulement 2 obtentions de logement social en 2021, ceci s\'explique par sa démographie très faible.

Une année après, en 2022, nous observons une augmentation relativement faible des personnes obtenant un logement social. Cette fois ci, Paris est devant avec 3400 obtentions et la Lozère reste dernière avec 11 obtentions. Nous ne constatons pas de mouvement particulier des départements prodiguant le plus d\'obtentions, cela reste globalement autour des grandes villes. 

Quant à l\'observation par régions, nous pouvons confirmer la légère augmentation d\'obtention et également la large domination de la région parisienne avec 12214 obtentions en 2021 et 15065 obtentions en 2022. On en conclut donc que moins une région est peuplée, moins elle propose des logements sociaux. Ce à quoi nous nous attendions. 
