---
title: "Rapport SDR"
output: html_document
date: "2024-01-19"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)

library(plotly)

```

## IMPORT des données

```{r import}
detail_departemental <- readr::read_delim("barometre-resultats-detail-departemental.csv", delim = ",", trim_ws = TRUE, show_col_types = FALSE)
detail_regional <- readr::read_delim("barometre-resultats-detail-regional.csv", delim = ",", trim_ws = TRUE, show_col_types = FALSE)
detail_national <- readr::read_delim("barometre-resultats-detail-national.csv", delim = ",", trim_ws = TRUE, show_col_types = FALSE)
synthese_departemental <- readr::read_delim("barometre-resultats-synthese-departemental.csv", delim = ",", trim_ws = TRUE, show_col_types = FALSE)
synthese_regional <- readr::read_delim("barometre-resultats-synthese-regional.csv", delim = ",", trim_ws = TRUE, show_col_types = FALSE)
synthese_national <- readr::read_delim("barometre-resultats-synthese-national.csv", delim = ",", trim_ws = TRUE, show_col_types = FALSE)

reg_dep <- readr::read_delim("departements-france.csv", delim = ",", trim_ws = TRUE, show_col_types = FALSE)


mapdata <- map_data("france")
mapdata$region <- tolower(gsub(' ','-',mapdata$region))

synthese_departemental$libelle_departement <- iconv(synthese_departemental$libelle_departement,to="ASCII//TRANSLIT")
synthese_departemental$libelle_departement <- gsub("'","",synthese_departemental$libelle_departement)
synthese_departemental$libelle_departement <- tolower(synthese_departemental$libelle_departement)
synthese_departemental$libelle_departement <- tolower(gsub(' ','-',synthese_departemental$libelle_departement))

detail_departemental$libelle_departement <- iconv(detail_departemental$libelle_departement,to="ASCII//TRANSLIT")
detail_departemental$libelle_departement <- gsub("'","",detail_departemental$libelle_departement)
detail_departemental$libelle_departement <- tolower(detail_departemental$libelle_departement)
detail_departemental$libelle_departement <- tolower(gsub(' ','-',detail_departemental$libelle_departement))


mapdata <- map_data("france")

mapdata$region <- iconv(mapdata$region,to="ASCII//TRANSLIT")
mapdata$region <- gsub("'","",mapdata$region)
mapdata$region <- tolower(mapdata$region)
mapdata$region <- tolower(gsub(' ','-',mapdata$region))
```

## Plan 1 jeune 1 solution

Dans cette partie, nous allons nous concentrer sur la mise en place du plan 1 jeune 1 solution mis en place à partir de l'été 2020.

Ce plan gouvernemental a pour objectif d'améliorer l'insertion des jeunes dans la vie professionnelle. Pour atteindre cet objectif, le plan se concentre sur 3 axes :

-Faciliter l'entrée dans la vie professionnelle avec des aides pour les employeurs qui recrutent des jeunes, des aides plus importantes sont aussi disponibles pour les contrats d'apprentissages. A cela s'ajoute la création de mission de service civique rémunérée et de métiers dans le secteur du sport.

-Orienter et former les jeunes, à l'aide de parcours de formations qualifiants et professionnalisants ndefinedndefineddans de no

-Proposer un accompagnement plus personnalisé pour les jeunes en difficultés.

Pour mesurer l'impact des mesures mises en place, notre base de données à choisi comme indicateur le nombre de jeune recrutés. Ainsi, pour chaque mois depuis août 2019, on a accès au nombre de jeune recrutés depuis le dernier mois d'août.

Afin d'étudier l'impact de ce plan à différentes échelles, nous allons effectuer un zoom progressif aux différentes échelles disponibles afin d'interpréter ces nombres.

Pour la première étape, nous allons étudier les chiffres à l'échelle nationale. Pour cela nous allons tracer le nombre de jeune recruter depuis le mois d'août dernier pour chaque mois depuis août 2019 à fin 2022 (information donnée par la base de données), mais aussi le nombre de jeunes recrutés par mois, afin de pouvoir suivre une progression continue.

Afin d'obtenir le nombre de recruter par mois, nous avons crée une nouvelle colonne qui prends pour valeur la différence du nombre de personne recruter depuis août pour un mois et qui fait la différence avec la valeur du mois précédent.

```{r 1 jeune 1 solution National}

UnJeuneNational <- detail_national |>
  filter(mesure=="Plan 1 jeune 1 solution") |>
  mutate(recrutés_par_mois = if_else(valeur>lag(valeur), valeur-lag(valeur), valeur, missing=valeur))|>
  rename(recrutés_cumulés = valeur) |>
  pivot_longer(c(recrutés_cumulés, recrutés_par_mois), names_to = "type", values_to = "valeur") |>
  mutate(year = year(date)) |>
  ggplot() + 
  geom_line(mapping=aes(x=date, y=valeur, fg=type)) +
  labs(title = "Jeunes recrutés grâce au projet",
       x = "Date",
       y = "Nombre de recrutement",
       fg="")


plotly::ggplotly(UnJeuneNational)


```

Tout d'abord, on peut très rapidement repérer une saisonnalitée importante grâce à la courbe de recrutement par mois. En effet, chaque année, le nombre de jeune recruté pendant le mois de septembre est très important par rapport au reste de l'année. Cette période de fort recrutement des jeunes peut sans doute être expliquer par le fait que le début d'année pour les jeunes et en septembre, ainsi de nombreux contrats d'apprentissages doivent commencer en septembre.

Ensuite, en regardant les pics de chaque année (donc le mois de juillet de chaque année), on peut remarquer une baisse du recrutement des jeunes en 2020. Cette chute est surement due à la crise COVID. Cette interprétation est corroborée par la chute observée autour d'avril 2020, le début de la crise COVID.

Après la grosse chute de recrutement mensuel causé par la crise, on observe une forte augmentation du recrutement à l'été 2020, cela coïncide avec le début du plan 1 jeune 1 solution. Il est donc raisonnable de supposer que ce plan à permis de neutralisé l'impact de la crise sur le recrutement des jeunes. Ainsi on observe une remontée du nombre de recrutement pour 2021 au niveau de celui de 2019. L'augmentation continue ensuite pour 2022.

```{r 1 jeune 1 solution Regions, fig.width=14}

UnJeuneNational <- detail_regional |>
  filter(mesure=="Plan 1 jeune 1 solution" & month(date)==7) |>
  mutate(year = year(date)) |>
  ggplot() + 
  geom_col(mapping = aes(x=libelle_region, y=valeur, bg=libelle_region))+
  theme(axis.text.x=element_blank(),axis.ticks.x=element_blank(),axis.title.x=element_blank())+
  facet_wrap(vars(year), nrow=1)+
  labs(title = "Jeunes recrutés grâce au projet par région",
       x = "Date",
       y = "Nombre de recrutement",
       bg="Région")

plotly::ggplotly(UnJeuneNational)

```

IDF GOES BRRRRRRR

```{r 1 jeune 1 solution region IdF}

UnJeuneIdF <- detail_regional |>
  filter(mesure=="Plan 1 jeune 1 solution" & code_region=="11") |>
  mutate(valeur_mois = if_else(valeur>lag(valeur), valeur-lag(valeur), valeur, missing=valeur))|>
  mutate(year = year(date)) |>
  ggplot() + 
  geom_line(mapping=aes(x=date, y=valeur_mois)) +
  labs(title = "Jeunes recrutés grâce au projet en Île de France",
       x = "Date",
       y = "Nombre de recrutement")

plotly::ggplotly(UnJeuneIdF)


```

```{r 1 jeune 1 solution départements IdF}

test <- detail_departemental |>
  filter(month(date)==7 & mesure=="Plan 1 jeune 1 solution")|>
  mutate(year = year(date))|>
  group_by(year)|>
  mutate(moyenne = mean(valeur))

UnJeuneDepIdF <- detail_departemental |>
  left_join(reg_dep, by = c("code_departement"="code_departement"))|>
  filter(mesure=="Plan 1 jeune 1 solution" & month(date)==7)|>
  add_column(moyenne = test$moyenne) |>
  filter(code_region=="11")|>
  mutate(year = year(date)) |>
  ggplot() + 
  geom_line(mapping=aes(x=year(date), y=valeur, fg = libelle_departement))+
  geom_line(mapping = aes(x = year(date), y=moyenne))  +
  labs(title = "Jeunes recrutés grâce au projet en Île de France par département",
       x = "Date",
       y = "Nombre de recrutement",
       fg="Département")


plotly::ggplotly(UnJeuneDepIdF)

```

Faire des Cartes :

```{r}
#import carte de la France


#view(mapdata)

#selection indicateurs
ind1 <- filter(synthese_departemental, mesure == "Réduire la mortalité sur les routes")

#Join des deux tableaux
mapdata1 <- left_join(mapdata, ind1, by = c("region" = "libelle_departement"))

map1 <- ggplot(mapdata1, aes(x=long, y=lat, group=group)) +
  geom_polygon(aes(fill=valeur_actuelle),color = "black")

map2 <- map1 + scale_fill_gradient(name="nombre de morts",low="green",high="red",na.value="gray")

map2
plotly::ggplotly(map2)
```

```{r}
#mapdata3 <- map_data("france")


#reg_dep

mapReg <- left_join(mapdata3, reg_dep, by = c("region" = "nom_departement"))

ind2 <- filter(synthese_regional, mesure == "Réduire la mortalité sur les routes")

regfin <- left_join(mapReg, ind2, by = c("nom_region" = "libelle_region"))

regfin

map5 <- ggplot(regfin, aes(x=long, y=lat, group=group)) +
  geom_polygon(aes(fill=valeur_actuelle),color = "black")+ 
  scale_fill_gradient(name="nombre de morts",low="green",high="red",na.value="gray")

map5
```

```{r}

indSDF_now_dep <- filter(synthese_departemental, indicateur == "Nombre de personnes sans-abri ou en hébergement ayant obtenu un logement social")

#Join des deux tableaux
mapdataSDF_now_dep <- left_join(mapdata, indSDF_now_dep, by = c("region" = "libelle_departement"))

mapSDF_now_dep <- ggplot(mapdataSDF_now_dep, aes(x=long, y=lat, group=group)) +
  geom_polygon(aes(fill=valeur_actuelle),color = "black")+ 
  scale_fill_gradient(name="personnes dans l'année*",low="cadetblue1",high="brown2",na.value="gray")

#mapSDF_now_dep
plotly::ggplotly(mapSDF_now_dep)

mapSDF_for_dep <- ggplot(mapdataSDF_now_dep, aes(x=long, y=lat, group=group)) +
  geom_polygon(aes(fill=valeur_initiale),color = "black")+ 
  scale_fill_gradient(name="personnes dans l'année",low="cadetblue1",high="brown2",na.value="gray")

plotly::ggplotly(mapSDF_for_dep)

indSDF_now_reg <- filter(synthese_regional, mesure == "Nombre de personnes sans-abri ou en hébergement ayant obtenu un logement social")

indSDF_now_dep

regSDF_now_reg <- left_join(mapReg, indSDF_now_reg, by = c("nom_region" = "libelle_region"))

mapSDF_now_reg <- ggplot(regfin, aes(x=long, y=lat, group=group)) +
  geom_polygon(aes(fill=valeur_actuelle),color = "black")+ 
  scale_fill_gradient(name="personnes dans l'année",low="cadetblue1",high="brown2",na.value="gray")

plotly::ggplotly(mapSDF_now_reg)

mapSDF_for_reg <- ggplot(regfin, aes(x=long, y=lat, group=group)) +
  geom_polygon(aes(fill=valeur_initiale),color = "black")+ 
  scale_fill_gradient(name="personnes dans l'année",low="cadetblue1",high="brown2",na.value="gray")

plotly::ggplotly(mapSDF_for_reg)
```
